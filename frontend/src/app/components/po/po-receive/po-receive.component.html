<ng-container *ngIf="isLoading; else content">
  <mat-progress-spinner [diameter]="80" mode="indeterminate" color="primary"></mat-progress-spinner>
</ng-container>

<ng-template #content>
  <mat-card class="mat-elevation-z10">
    <mat-card-header>
      <mat-card-title>Receive Purchase Order {{ orderId }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="itemsForm" (ngSubmit)="receiveItems()">
        <div formArrayName="items">
        <table mat-table [dataSource]="items.controls">
          <ng-container matColumnDef="productId">
            <th mat-header-cell *matHeaderCellDef>Product</th>
            <td mat-cell *matCellDef="let row">
              {{ row.value.productId }} - {{ row.value.productName }}
            </td>
          </ng-container>
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef>Ordered</th>
            <td mat-cell *matCellDef="let row">{{ row.value.quantity }}</td>
          </ng-container>
          <ng-container matColumnDef="receivedQuantity">
            <th mat-header-cell *matHeaderCellDef>Received</th>
            <td mat-cell *matCellDef="let row">{{ row.value.receivedQuantity }}</td>
          </ng-container>
          <ng-container matColumnDef="remainingQuantity">
            <th mat-header-cell *matHeaderCellDef>Remaining</th>
            <td mat-cell *matCellDef="let row">{{ row.value.remainingQuantity }}</td>
          </ng-container>
          <ng-container matColumnDef="receiveQuantity">
            <th mat-header-cell *matHeaderCellDef>Receive Now</th>
            <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
              <mat-form-field>
                <input matInput type="number" formControlName="receiveQuantity" />
              </mat-form-field>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="['productId','quantity','receivedQuantity','remainingQuantity','receiveQuantity']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['productId','quantity','receivedQuantity','remainingQuantity','receiveQuantity']"></tr>
        </table>
        </div>

        <div style="margin-top: 16px;">
          <button mat-raised-button color="primary" type="submit">Receive</button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</ng-template>
