<mat-card class="mat-elevation-z10">
  <mat-card-header>
    <mat-card-title>{{ 'BOM.CREATE_TITLE' | translate }}</mat-card-title>
  </mat-card-header>
  <mat-card-content [formGroup]="form">
    <div class="form-grid two-col">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'BOM.TYPE' | translate }}</mat-label>
        <mat-select formControlName="bomType">
          <mat-option *ngFor="let type of bomTypes" [value]="type.productAssocTypeId">
            {{ type.description || type.productAssocTypeId }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('bomType')?.hasError('required')">
          {{ 'COMMON.REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>{{ 'BOM.OPERATION' | translate }}</mat-label>
        <input matInput formControlName="operation" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>{{ 'BOM.ITEM' | translate }}</mat-label>
        <input matInput formControlName="item" [matAutocomplete]="itemAuto" />
        <mat-autocomplete #itemAuto="matAutocomplete">
          <mat-option
            *ngFor="let product of filteredItemProducts$ | async"
            [value]="product.productId"
          >
            {{ product.productId }} - {{ product.name }}
          </mat-option>
        </mat-autocomplete>
        <mat-error *ngIf="form.get('item')?.hasError('required')">
          {{ 'COMMON.REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>

    </div>
  </mat-card-content>
</mat-card>

<br />

<mat-card class="mat-elevation-z10">
  <mat-card-header>
    <mat-card-title>
      {{ 'BOM.ITEMS' | translate }}
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div class="item-inline-form">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'BOM.COMPONENT' | translate }}</mat-label>
        <input matInput [matAutocomplete]="componentAuto" [formControl]="componentProductControl" />
        <mat-autocomplete #componentAuto="matAutocomplete">
          <mat-option
            *ngFor="let product of filteredComponentProducts$ | async"
            [value]="product.productId"
          >
            {{ product.productId }} - {{ product.name }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>{{ 'BOM.SEQ_NUM' | translate }}</mat-label>
        <input matInput [(ngModel)]="newItem.sequenceNum" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>{{ 'BOM.QTY' | translate }}</mat-label>
        <input matInput type="number" [(ngModel)]="newItem.quantity" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>{{ 'BOM.FROM_DATE' | translate }}</mat-label>
        <input
          matInput
          [matDatepicker]="itemFromDatePicker"
          [(ngModel)]="newItem.fromDate"
          (click)="itemFromDatePicker.open()"
        />
        <mat-datepicker-toggle matSuffix [for]="itemFromDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #itemFromDatePicker></mat-datepicker>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="addItem()">
        {{ 'COMMON.ADD_ITEM' | translate }}
      </button>
    </div>
    <table mat-table [dataSource]="items">
      <ng-container matColumnDef="component">
        <th mat-header-cell *matHeaderCellDef>{{ 'BOM.COMPONENT' | translate }}</th>
        <td mat-cell *matCellDef="let item">
          {{ item.componentProductId }}
        </td>
      </ng-container>
      <ng-container matColumnDef="sequenceNum">
        <th mat-header-cell *matHeaderCellDef>{{ 'BOM.SEQ_NUM' | translate }}</th>
        <td mat-cell *matCellDef="let item">{{ item.sequenceNum || '-' }}</td>
      </ng-container>
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef>{{ 'BOM.QTY' | translate }}</th>
        <td mat-cell *matCellDef="let item">{{ item.quantity }}</td>
      </ng-container>
      <ng-container matColumnDef="fromDate">
        <th mat-header-cell *matHeaderCellDef>{{ 'BOM.FROM_DATE' | translate }}</th>
        <td mat-cell *matCellDef="let item">{{ item.fromDate | date : "MMM d, y" }}</td>
      </ng-container>
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let item; let i = index">
          <mat-icon class="custom-mat-icon custom-icon-align" color="warn" (click)="removeItem(i)">delete</mat-icon>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </mat-card-content>
  <mat-card-actions class="actions">
    <button mat-raised-button color="primary" (click)="save()" [disabled]="isSaving">
      {{ 'COMMON.SAVE' | translate }}
    </button>
  </mat-card-actions>
</mat-card>
