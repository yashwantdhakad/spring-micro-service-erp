<ng-container *ngIf="isLoading; else content">
  <mat-progress-spinner
    [diameter]="100"
    mode="indeterminate"
    color="primary"
  ></mat-progress-spinner>
</ng-container>

<ng-template #content>
  <div class="bom-toolbar">
    <div class="filters">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>{{ 'BOM.TYPE' | translate }}</mat-label>
        <mat-select [(ngModel)]="selectedBomType" (selectionChange)="applyFilters()">
          <mat-option value="">{{ 'COMMON.ALL' | translate }}</mat-option>
          <mat-option *ngFor="let type of bomTypes" [value]="type.productAssocTypeId">
            {{ type.description || type.productAssocTypeId }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>{{ 'BOM.PRODUCT' | translate }}</mat-label>
        <input
          matInput
          [(ngModel)]="productFilter"
          (input)="applyFilters()"
          placeholder="{{ 'COMMON.SEARCH' | translate }}"
        />
      </mat-form-field>

      <button mat-stroked-button color="primary" (click)="clearFilters()">
        {{ 'COMMON.CLEAR' | translate }}
      </button>
    </div>
  </div>

  <mat-card class="mat-elevation-z10">
    <mat-card-header>
      <mat-card-title>{{ 'BOM.TITLE' | translate }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="pagedBoms">
        <ng-container matColumnDef="bomId">
          <th mat-header-cell *matHeaderCellDef>{{ 'BOM.ID' | translate }}</th>
          <td mat-cell *matCellDef="let item">
            <a [routerLink]="['/jobs/boms', item.bomId]">{{ item.bomId }}</a>
            <div class="muted">{{ item.bomTypeLabel || item.bomType || 'Manufacturing' }}</div>
          </td>
        </ng-container>
        <ng-container matColumnDef="product">
          <th mat-header-cell *matHeaderCellDef>{{ 'BOM.PRODUCT' | translate }}</th>
          <td mat-cell *matCellDef="let item">
            <a [routerLink]="['/products', item.productId]">{{ item.productId }}</a>
            <div class="muted">{{ item.productName || item.productId }}</div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="['bomId', 'product']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['bomId', 'product']"></tr>
      </table>
      <mat-paginator
        [pageSize]="pagination.rowsPerPage"
        [length]="pages"
        (page)="onPageChange($event.pageIndex)"
      ></mat-paginator>
    </mat-card-content>
  </mat-card>
</ng-template>
